From 11afba742300ae70092332471abd0c85cdc86d4e Mon Sep 17 00:00:00 2001
From: Oleksandr Grytsov <oleksandr_grytsov@epam.com>
Date: Thu, 26 Apr 2018 17:11:01 +0300
Subject: [PATCH 1/2] add go version 1.10.1

Signed-off-by: Oleksandr Grytsov <oleksandr_grytsov@epam.com>
---
 recipes-devtools/go/go-cross_1.10.1.bb | 15 +++++++++
 recipes-devtools/go/go_1.10.1.bb       | 44 ++++++++++++++++++++++++++
 recipes-devtools/go/go_1.10.1.inc      | 14 ++++++++
 3 files changed, 73 insertions(+)
 create mode 100644 recipes-devtools/go/go-cross_1.10.1.bb
 create mode 100644 recipes-devtools/go/go_1.10.1.bb
 create mode 100644 recipes-devtools/go/go_1.10.1.inc

diff --git a/oe-meta-go/recipes-devtools/go/go-cross_1.10.1.bb b/oe-meta-go/recipes-devtools/go/go-cross_1.10.1.bb
new file mode 100644
index 0000000..4eae3f4
--- /dev/null
+++ b/oe-meta-go/recipes-devtools/go/go-cross_1.10.1.bb
@@ -0,0 +1,15 @@
+require go-cross.inc
+require go_${PV}.inc
+
+# Go binaries are not understood by the strip tool.
+INHIBIT_SYSROOT_STRIP = "1"
+
+do_compile() {
+  go_compile
+}
+
+do_install() {
+  go_install
+}
+
+## TODO: implement do_clean() and ensure we actually do rebuild super cleanly
diff --git a/oe-meta-go/recipes-devtools/go/go_1.10.1.bb b/oe-meta-go/recipes-devtools/go/go_1.10.1.bb
new file mode 100644
index 0000000..79c56a8
--- /dev/null
+++ b/oe-meta-go/recipes-devtools/go/go_1.10.1.bb
@@ -0,0 +1,44 @@
+require go_${PV}.inc
+
+#PN_class-native = "go-native"
+#PN_class-cross = "go-cross-${TARGET_ARCH}"
+
+GOROOT_FINAL="${libdir}/go"
+GOROOT_FINAL_class-native="${STAGING_LIBDIR_NATIVE}/go"
+export GOROOT_FINAL
+
+# Go binaries are not understood by the strip tool.
+INHIBIT_SYSROOT_STRIP = "1"
+
+do_compile() {
+  go_compile
+}
+
+do_install() {
+  go_install
+}
+
+do_install_class-target() {
+  setup_go_arch
+
+  go_install
+
+  if test "${GOHOSTOS}_${GOHOSTARCH}" != "${GOOS}_${GOARCH}" ; then
+    mv "${D}${bindir}/${GOOS}_${GOARCH}/"* "${D}${bindir}/"
+    rmdir "${D}${bindir}/${GOOS}_${GOARCH}"
+    rm -rf "${D}${GOROOT_FINAL}/pkg/${GOHOSTOS}_${GOHOSTARCH}"
+    rm -rf "${D}${GOROOT_FINAL}/pkg/tool/${GOHOSTOS}_${GOHOSTARCH}"
+    # XXX: too aggressive?
+    find "${D}" -name "*_${GOHOSTARCH}.syso" -delete
+  fi
+
+  rm -rf "${D}${GOROOT_FINAL}"/src/debug/*/testdata/
+
+  chown -R root:root "${D}"
+}
+
+## TODO: implement do_clean() and ensure we actually do rebuild super cleanly
+
+INSANE_SKIP_go = "staticdev"
+
+BBCLASSEXTEND = "native"
diff --git a/oe-meta-go/recipes-devtools/go/go_1.10.1.inc b/oe-meta-go/recipes-devtools/go/go_1.10.1.inc
new file mode 100644
index 0000000..da9f238
--- /dev/null
+++ b/oe-meta-go/recipes-devtools/go/go_1.10.1.inc
@@ -0,0 +1,14 @@
+require go.inc
+
+DEPENDS = "go-bootstrap-native"
+
+SSTATE_SCAN_CMD = "true"
+
+SRC_URI = "${SRC_URI_PREFIX}/go${PV}.src.tar.gz;subdir=go-${PV}"
+SRC_URI[md5sum] = "d55e8b2c6272ab1abf5e4e6cdaaca680"
+SRC_URI[sha256sum] = "589449ff6c3ccbff1d391d4e7ab5bb5d5643a5a41a04c99315e55c16bbf73ddc"
+
+SRC_URI += "\
+        "
+
+LIC_FILES_CHKSUM = "file://${WORKDIR}/go-${PV}/go/LICENSE;md5=5d4950ecb7b26d2c5e4e7b4e0dd74707"
-- 
2.17.1

